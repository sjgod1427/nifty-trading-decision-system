# ğŸ¯ NIFTY Trading Decision System

Machine Learning system to predict whether the next candle's closing price will go **up** or **down** using NIFTY intraday historical data.

**Best Model**: Calibrated Random Forest with **57.82% accuracy** (improved from 53.49% baseline)

## ğŸ“Š Assignment Requirements Met

âœ… **Label Generation**: Binary classification (1=up, 0=down)
âœ… **Multiple ML Models**: Logistic Regression, Random Forest, LightGBM, XGBoost, CatBoost
âœ… **Model Comparison**: Tested 5+ strategies, selected best performing
âœ… **Train/Test Split**: 70/30 time-based split
âœ… **Evaluation Metrics**: Accuracy, Precision, Recall, F1-Score, Confusion Matrix
âœ… **Signal Generation**: Buy/Sell signals with cumulative PnL calculation
âœ… **Output Format**: Final CSV with timestamp, close, predicted, model_call, model_pnl

## ğŸ“ˆ Performance

- **Best Accuracy**: 57.82%
- **Baseline**: 53.49%
- **Improvement**: +4.33 percentage points
- **Model**: Calibrated Random Forest with 20 selected features

---

## ğŸš€ Quick Start

### Installation

```bash
pip install -r requirements.txt
```

### Train & Evaluate Models

```bash
# Run main assignment script (generates required output)
python basic_approach.py

# This will:
# 1. Train multiple models (Logistic Regression, Random Forest, LightGBM, XGBoost)
# 2. Compare and select best model
# 3. Evaluate with accuracy, precision, recall
# 4. Generate signals and calculate PnL
# 5. See the results generated by the basic approaches
```

### Advanced: Production Model (Optional)

```bash
# Production model with advanced optimizations (57.82% accuracy)
python train_production.py

#This is the model that gave the best accuracy after trying multiple approaches 
#This saves the final_prediction , metrics evaluation and the test data used in the final_output folder in the root
```

### ğŸŒ Web Dashboard (Streamlit App)

```bash
# Launch the interactive web dashboard
streamlit run streamlit_app.py

# The app will open in your browser at http://localhost:8501
```

**Dashboard Features**:
- ğŸ“Š Interactive charts with buy/sell signals
- ğŸ“ˆ Real-time PnL visualization
- ğŸ“‹ Filterable predictions table
- ğŸ¯ Model performance metrics
- ğŸ’¾ Download predictions as CSV
- ğŸ“± Modern, responsive UI

---

## ğŸ“ Project Structure

```
nifty-trading-decision-system/
â”œâ”€â”€ src/                    # Core modules
â”‚   â”œâ”€â”€ data_loader.py     # Data loading & preprocessing
â”‚   â”œâ”€â”€ feature_engineer.py # Technical indicators (51 features)
â”‚   â”œâ”€â”€ model_trainer.py   # Model training
â”‚   â””â”€â”€ evaluator.py       # Evaluation & metrics
â”‚
â”œâ”€â”€ experiments/            # Research scripts
â”‚   â”œâ”€â”€ train_optimized.py
â”‚   â”œâ”€â”€ train_advanced_strategies.py
â”‚   â”œâ”€â”€ train_ultimate.py
â”‚   â””â”€â”€ train_quick.py
â”œâ”€â”€ final_output/                 # final predictions , metrics and test data used
â”‚
â”œâ”€â”€ models/                 # Trained models (gitignored)
â”œâ”€â”€ output/                 # Results (gitignored)
â”‚
â”œâ”€â”€ config.py              # Configuration
â”œâ”€â”€ basic_approach.py                # Baseline training
â”œâ”€â”€ train_production.py    # Production training â­
â”œâ”€â”€ streamlit_app.py       # Web dashboard ğŸŒ
â”œâ”€â”€ requirements.txt       # Dependencies
â”œâ”€â”€ README.md             # This file
â””â”€â”€ APPROACH.md           # Technical documentation
```

---

## ğŸ¯ Key Features

### Technical Indicators (Top 20 Selected)
- MACD, RSI, Stochastic Oscillator
- Bollinger Bands, ATR
- Moving averages (SMA, EMA)
- Momentum and volatility indicators

### ML Pipeline
- Probability calibration for confidence estimates
- Feature selection (20 from 51 features)
- Class balancing
- 0.15% movement threshold (filters noise)
- Time-series cross-validation

---

## ğŸ“ˆ Results

### Model Comparison

| Strategy | Accuracy | Use Case |
|----------|----------|----------|
| **Calibrated RF** | **57.82%** | **Production** |
| Advanced Stacking | 56.30% | Alternative |
| Feature Selection | 54.39% | Research |
| Baseline | 53.49% | Reference |

### Market Insights

**Best Trading Conditions**:
- High volatility + trending: **59.82%** accuracy
- Opening session (9:15-10:30): **58.43%** accuracy

**Avoid**:
- Mid-day ranging markets: 48.39% accuracy

---

## ğŸ“„ Output Format

The script generates `final_output/final_predictions.csv` with the following columns:

| Column | Description |
|--------|-------------|
| **timestamp** | Date & time of the candle |
| **close** | Closing price of the candle |
| **predicted** | Model prediction (1=up, 0=down) |
| **model_call** | Trading signal ('buy' or 'sell') |
| **model_pnl** | Cumulative profit/loss |

**Sample Output**:
```
timestamp,close,predicted,model_call,model_pnl
2024-09-10 15:29:00,24977.55,1,buy,-24977.55
2024-09-10 15:28:00,24978.45,0,sell,0.90
```

---

## ğŸ’» Usage Examples

### Basic Usage

```bash
# Run the complete pipeline
python basic_approach.py

# This will:
# - Load and preprocess data
# - Create target labels (1=up, 0=down)
# - Train 4 different models
# - Compare and select best model
# - Generate evaluation metrics
# - Create trading signals
# - Calculate cumulative PnL
# - Save output to output/final_predictions.csv
```

### View Results

```bash
# View final predictions
cat final_output/final_predictions.csv | head -20

# View metrics report
cat final_output/model_evaluation_report.txt
```

### Configuration

Edit `config.py` to customize:

```python
MIN_MOVEMENT_PCT = 0.15  # Target threshold (0.15 = best)
TRAIN_TEST_SPLIT_RATIO = 0.7  # 70/30 split
```

---

## ğŸ”§ Advanced Usage

### Run Experiments

```bash
# Quick validation
python experiments/train_quick.py

# Full strategy comparison
python experiments/train_advanced_strategies.py

# Regime-based analysis
python experiments/train_ultimate.py

#Time series approach 
python experiments/lstm.py
```

### Custom Training

See `train_production.py` for the full pipeline:
1. Load data with 0.15% threshold
2. Create 51 technical indicators
3. Select top 20 features
4. Train calibrated Random Forest
5. Evaluate with multiple metrics


###  Training With LSTM

See `lstm.py` for the full pipeline:
1. Used only the close column
2. Used a time series model with context 
3. Best performance was by this model with R2 score .92
4. It was not included in the main pipeline as ONLY ML APPROACHES were asked in Assignment PDF

---



## ğŸ¯ Model Performance Summary

**Why Calibrated Random Forest Performed Best:**
The calibrated Random Forest achieved 57.82% accuracy by combining ensemble learning with probability calibration. Key factors: (1) 0.15% movement threshold filtered noise, (2) feature selection reduced from 51 to 20 features preventing overfitting, (3) probability calibration improved confidence estimates, (4) class balancing handled slight imbalances. This outperformed simpler models (Logistic Regression: 50.44%) and other gradient boosting methods (XGBoost: 51.99%, LightGBM: 52.23%).

## ğŸ“š Documentation

- **README.md** (this file) - Quick start & overview
- **APPROACH.md** - Complete technical documentation
  - Problem statement & solution architecture
  - Feature engineering strategy
  - Model selection & comparison
  - Evaluation methodology
  - Production improvements & optimizations
  - Final results & key learnings

---

## âš ï¸ Important Notes

**Before Live Trading**:
- âœ… Paper trade for minimum 2 weeks
- âœ… Validate on recent unseen data
- âœ… Account for transaction costs
- âœ… Start with minimal capital

**Limitations**:
- Not financial advice - use at your own risk
- Market conditions change - retrain monthly
- Transaction costs matter - factor in brokerage & slippage
- Past performance â‰  future results

---

## ğŸ”„ Maintenance

- **Weekly**: Check performance metrics
- **Monthly**: Retrain model on recent data
- **Quarterly**: Review and update features

---

## ğŸ¤ Contributing

Improvements welcome! Focus areas:
- Additional technical indicators
- Alternative ML models (classical only)
- Better regime detection
- Risk management enhancements

---

## ğŸ“ Version

**Current**: 1.0.0 - Production Ready
**Status**: âœ… Deployed

**Accuracy**: 57.82% | **Baseline**: 53.49% | **Improvement**: +4.33%

---

## ğŸ“„ License

For educational and research purposes.

---

## ğŸ†˜ Need Help?

1. Check `APPROACH.md` for technical details
2. Review `config.py` for configuration options
3. Look at `experiments/` for research examples
4. Ensure `MIN_MOVEMENT_PCT = 0.15` in config.py

---

**Disclaimer**: This system is for educational purposes. Trading involves risk. Never invest more than you can afford to lose.
